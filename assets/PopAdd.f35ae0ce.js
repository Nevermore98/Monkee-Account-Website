import{d as E,t as H}from"./index.af296ac2.js";import{a as T}from"./axios.9c966455.js";import{_ as X}from"./index.4a90c7e5.js";import{r,E as Y,R as Z,o as $,Q as ee,a as p,b as d,c as S,w as b,f as o,d as h,H as w,O as k,g as y,F as N,J as j,q as _,K as ae,M as ne}from"./vendor.c046acaf.js";const te={emits:["refresh"],props:{initData:Object},setup(i,s){const D=i.initData&&i.initData.id,e=r(!1),C=r(!1),m=r("expense"),u=r(new Date),a=r(""),l=Y({id:0,name:""}),x=r([]),g=r([]),f=r(""),F=r("#39be77"),t=r(null),c=()=>{a.value=i.initData.amount||"",l.id=i.initData.type_id||0,l.name=i.initData.type_name||"",u.value=E(Number(i.initData.date)).$d,f.value=i.initData.remark||"",m.value=i.initData.pay_type===1?"expense":"income"};Z(()=>i.initData,()=>{D&&c()},{deep:!0,immediate:!0}),$(async()=>{var v;const{data:{list:n}}=await T.get("/type/list");x.value=n.filter(B=>B.type==1),g.value=n.filter(B=>B.type==2),(v=t.value)==null||v.reset()});const L=n=>{m.value=n,A()},M=n=>{Object.assign(l,n)},R=n=>`#icon-${H[n.id].icon}`,A=()=>{const n=document.querySelector(".van-key--blue");m.value==="expense"?n.style.background="#39be77":n.style.background="#ecbe25"},U={calendarPopupHeight:"62%",calendarSelectedDayBackgroundColor:"#39be77",calendarHeaderTitleHeight:"40px"},q=new Date(2021,5,1),V=new Date,z=ee(()=>E(Number(u.value)).format("MM-DD")),J=n=>{C.value=!1,u.value=n},K=()=>{var n;(n=t.value)==null||n.reset()},Q=n=>{if(n!==".")return n===0&&a.value.substring(0,1)==="0"&&a.value.indexOf(".")===-1?a.value:n!==0&&a.value.substring(0,1)==="0"&&a.value.indexOf(".")===-1?a.value=n.toString():a.value.length>=6&&a.value.indexOf(".")===-1?(_({message:"\u91D1\u989D\u4E0D\u80FD\u5927\u4E8E1,000,000",position:"bottom"}),a.value):a.value.includes(".")&&a.value.split(".")[1].length>=2?(_({message:"\u4EC5\u4FDD\u7559\u5C0F\u6570\u70B9\u540E\u4E24\u4F4D",position:"bottom"}),a.value):a.value+=n;if(n===".")return a.value.substring(0,1)===""?a.value="0.":a.value.includes(".")?a.value:a.value+="."},G=async()=>{if(!a.value){_({message:"\u8BF7\u8F93\u5165\u5177\u4F53\u91D1\u989D",position:"bottom"});return}if(Number(a.value).toFixed()==="0"){_({message:"\u8F93\u5165\u91D1\u989D\u4E0D\u80FD\u4E3A\u96F6",position:"bottom"});return}if(!l.name){_({message:"\u8BF7\u9009\u62E9\u6536\u652F\u7C7B\u578B",position:"bottom"});return}const n={amount:Number(a.value).toFixed(2),type_id:l.id,type_name:l.name,date:(E(u.value).unix()*1e3).toString(),pay_type:m.value=="expense"?1:2,remark:f.value||""};try{if(D){n.id=D;const v=await T.post("/bill/update",n);e.value=!1,_.success("\u4FEE\u6539\u6210\u529F"),s.emit("refresh")}else{const v=await T.post("/bill/add",n);P(),_.success("\u6DFB\u52A0\u6210\u529F"),s.emit("refresh")}}catch(v){console.log(v)}},W=()=>{a.value=a.value.slice(0,a.value.length-1)},I=()=>{a.value="",l.id=0,l.name="",m.value="expense",A(),e.value=!1,u.value=new Date,f.value=""},P=()=>{D?(c(),A()):I()};return{isShowAdd:e,isShowAddDate:C,payType:m,changeType:L,selectedDate:u,minDate:q,maxDate:V,chooseDate:J,calendarThemeVars:U,numberPadButtonColor:F,formattedDate:z,handleInput:Q,handleDelete:W,billAmount:a,expenseList:x,incomeList:g,chooseTypeIcon:M,typeMap:H,selectedType:l,getHref:R,addBill:G,remark:f,clearPopAdd:P,clearPopAddInHome:I,reset:K}}},O=i=>(ae("data-v-48a0cf1e"),i=i(),ne(),i),oe={class:"add-wrap"},se={class:"header"},ie={class:"close-wrap"},le={class:"filter-wrap"},ce={class:"type"},re=O(()=>o("svg",{class:"icon icon-sort-down"},[o("use",{"xlink:href":"#icon-sort-down"})],-1)),de={class:"numberPad"},ue=O(()=>o("span",{class:"prefix"},"\uFFE5",-1)),me={class:"amount animation"},ve={class:"type-wrap"},pe={key:0,class:"type-body"},_e={class:"type-icon icon"},fe=["xlink:href"],he={key:1,class:"type-body income-type-body"},ye={class:"type-icon icon"},De=["xlink:href"],be={class:"remark"};function xe(i,s,D,e,C,m){const u=p("van-icon"),a=p("van-button"),l=p("van-calendar"),x=p("van-config-provider"),g=p("van-field"),f=p("van-number-keyboard"),F=p("van-popup");return d(),S(F,{show:e.isShowAdd,"onUpdate:show":s[6]||(s[6]=t=>e.isShowAdd=t),position:"bottom",round:"",onClose:e.clearPopAdd},{default:b(()=>[o("div",oe,[o("header",se,[o("span",ie,[h(u,{name:"cross",onClick:s[0]||(s[0]=t=>e.isShowAdd=!1)})])]),o("div",le,[o("div",ce,[o("span",{onClick:s[1]||(s[1]=t=>e.changeType("expense")),class:w({expense:!0,active:e.payType==="expense"})},"\u652F\u51FA",2),o("span",{onClick:s[2]||(s[2]=t=>e.changeType("income")),class:w({income:!0,active:e.payType==="income"})},"\u6536\u5165",2)]),h(a,{class:"date",onClick:s[3]||(s[3]=t=>e.isShowAddDate=!0)},{default:b(()=>[o("span",null,k(e.formattedDate),1),re]),_:1})]),h(x,{"theme-vars":e.calendarThemeVars},{default:b(()=>[h(l,{show:e.isShowAddDate,"onUpdate:show":s[4]||(s[4]=t=>e.isShowAddDate=t),"show-confirm":!1,onConfirm:e.chooseDate,"row-height":60,"max-date":e.maxDate,"min-date":e.minDate,ref:"calendarRef",onClose:e.reset},null,8,["show","onConfirm","max-date","min-date","onClose"])]),_:1},8,["theme-vars"]),o("div",de,[ue,o("span",me,k(e.billAmount),1)]),o("div",ve,[e.payType=="expense"?(d(),y("div",pe,[(d(!0),y(N,null,j(e.expenseList,t=>(d(),S(a,{class:"type-item",key:t.id,onClick:c=>e.chooseTypeIcon(t)},{default:b(()=>{var c;return[o("div",{class:w({"icon-wrap":!0,expense:!0,active:((c=e.selectedType)==null?void 0:c.id)===t.id})},[(d(),y("svg",_e,[o("use",{"xlink:href":e.getHref(t)},null,8,fe)]))],2),o("div",null,k(t.name),1)]}),_:2},1032,["onClick"]))),128))])):(d(),y("div",he,[(d(!0),y(N,null,j(e.incomeList,t=>(d(),S(a,{class:"type-item",key:t.id,onClick:c=>e.chooseTypeIcon(t)},{default:b(()=>{var c;return[o("span",{class:w({"icon-wrap":!0,income:!0,active:((c=e.selectedType)==null?void 0:c.id)===t.id})},[(d(),y("svg",ye,[o("use",{"xlink:href":e.getHref(t)},null,8,De)]))],2),o("span",null,k(t.name),1)]}),_:2},1032,["onClick"]))),128))]))]),o("div",be,[h(g,{modelValue:e.remark,"onUpdate:modelValue":s[5]||(s[5]=t=>e.remark=t),label:"\u5907\u6CE8",placeholder:"\u6DFB\u52A0\u8BB0\u8D26\u5907\u6CE8",maxlength:"15",clearable:"","show-word-limit":""},null,8,["modelValue"])]),h(f,{show:!0,theme:"custom","extra-key":".","close-button-text":"\u786E\u5B9A",onDelete:e.handleDelete,onInput:e.handleInput,onClose:e.addBill},null,8,["onDelete","onInput","onClose"])])]),_:1},8,["show","onClose"])}var Fe=X(te,[["render",xe],["__scopeId","data-v-48a0cf1e"]]);export{Fe as P};
