var D=Object.defineProperty,$=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var w=(o,e,s)=>e in o?D(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s,y=(o,e)=>{for(var s in e||(e={}))E.call(e,s)&&w(o,s,e[s]);if(C)for(var s of C(e))L.call(e,s)&&w(o,s,e[s]);return o},h=(o,e)=>$(o,T(e));import{H as P}from"./Header.ac8caaef.js";import{_ as F}from"./index.4a90c7e5.js";import{r as b,E as B,o as R,G as V,b as f,g as _,f as m,a as v,d as c,w as g,q as I,K as A,M,c as N,h as x,e as j,O as H}from"./vendor.c046acaf.js";import{a as S}from"./axios.9c966455.js";const U={setup(){const o=b(null),e=B({pool:"ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890",width:100,height:50,verifyCode:""});R(()=>{e.verifyCode=i()});const s=()=>{e.verifyCode=i()},a=(t,r)=>parseInt(Math.random()*(r-t)+t),u=(t,r)=>{const n=a(t,r),d=a(t,r),p=a(t,r);return`rgb(${n},${d},${p})`},i=()=>{const t=o.value.getContext("2d");t.fillStyle=u(180,230),t.fillRect(0,0,e.width,e.height);let r="";for(let n=0;n<4;n++){const d=e.pool[a(0,e.pool.length)];r+=d;const p=a(20,30),l=a(-35,35);t.font=p+"px Simhei",t.textBaseline="top",t.fillStyle=u(80,150),t.save(),t.translate(25*n+15,25),t.rotate(l*Math.PI/180),t.fillText(d,-15+5,-15),t.restore()}for(let n=0;n<5;n++)t.beginPath(),t.moveTo(a(0,e.width),a(0,e.height)),t.lineTo(a(0,e.width),a(0,e.height)),t.strokeStyle=u(180,230),t.closePath(),t.stroke();for(let n=0;n<50;n++)t.beginPath(),t.arc(a(0,e.width),a(0,e.height),1,0,2*Math.PI),t.closePath(),t.fillStyle=u(150,200),t.fill();return r};return h(y({},V(e)),{verifyCanvasRef:o,handleDraw:s})}},q={class:"verify-canvas"},G=["width","height"];function K(o,e,s,a,u,i){return f(),_("div",q,[m("canvas",{ref:"verifyCanvasRef",width:o.width,height:o.height,onClick:e[0]||(e[0]=(...t)=>a.handleDraw&&a.handleDraw(...t))},null,8,G)])}var O=F(U,[["render",K],["__scopeId","data-v-58d72729"]]),z="./assets/monkey.f16f78c8.png";const J={name:"Login",components:{Header:P,VueImgVerify:O},setup(){const o=b(null),e=B({username:"",password:"",type:"register",verifyInput:"",verifyCode:"",loading:!1}),s=async u=>{try{if(e.type==="login"){const{data:i}=await S.post("/user/login",{username:e.username,password:e.password});localStorage.setItem("token",i.token),window.location.href="/"}else{if(e.verifyCode=o.value.verifyCode||"",o.value.verifyCode.toLowerCase()!==e.verifyInput.toLowerCase()){I.fail("\u9A8C\u8BC1\u7801\u9519\u8BEF");return}e.loading=!0;const{data:i}=await S.post("/user/register",{username:e.username,password:e.password});I.success("\u6CE8\u518C\u6210\u529F"),e.type="login",e.loading=!1}}catch{e.loading=!1}},a=u=>{e.type=u};return h(y({},V(e)),{onSubmit:s,changeType:a,verifyRef:o})}},k=o=>(A("data-v-6223857a"),o=o(),M(),o),Q={class:"auth"},W=k(()=>m("div",{class:"title"},"\u840C\u5947\u8BB0\u8D26",-1)),X=k(()=>m("img",{class:"logo",src:z,alt:"logo"},null,-1)),Y={class:"form-wrap"},Z={class:"button-wrap"};function ee(o,e,s,a,u,i){const t=v("van-field"),r=v("VueImgVerify"),n=v("van-cell-group"),d=v("van-button"),p=v("van-form");return f(),_("div",Q,[W,X,c(p,{onSubmit:a.onSubmit},{default:g(()=>[m("div",Y,[c(n,{inset:""},{default:g(()=>[c(t,{clearable:"",modelValue:o.username,"onUpdate:modelValue":e[0]||(e[0]=l=>o.username=l),name:"username",label:"\u8D26\u53F7",placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u8D26\u53F7"}],autocomplete:"on"},null,8,["modelValue"]),c(t,{clearable:"",modelValue:o.password,"onUpdate:modelValue":e[1]||(e[1]=l=>o.password=l),type:"password",name:"password",label:"\u5BC6\u7801",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u51656-20\u4F4D\u5BC6\u7801\uFF0C\u533A\u5206\u5927\u5C0F\u5199"}],autocomplete:"on"},null,8,["modelValue"]),o.type==="register"?(f(),N(t,{key:0,center:"",clearable:"",label:"\u9A8C\u8BC1\u7801",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",modelValue:o.verifyInput,"onUpdate:modelValue":e[2]||(e[2]=l=>o.verifyInput=l),autocomplete:"on"},{button:g(()=>[c(r,{ref:"verifyRef"},null,512)]),_:1},8,["modelValue"])):x("",!0)]),_:1})]),m("div",Z,[c(d,{round:"",block:"",type:"primary","native-type":"submit",class:"submit-btn"},{default:g(()=>[j(H(o.type==="register"?"\u6CE8\u518C":"\u767B\u5F55"),1)]),_:1}),o.type==="register"?(f(),_("p",{key:0,onClick:e[3]||(e[3]=l=>a.changeType("login")),class:"change-btn"}," \u767B\u5F55\u5DF2\u6709\u8D26\u53F7 ")):(f(),_("p",{key:1,onClick:e[4]||(e[4]=l=>a.changeType("register")),class:"change-btn"}," \u6CA1\u6709\u8D26\u53F7\uFF0C\u524D\u5F80\u6CE8\u518C "))])]),_:1},8,["onSubmit"])])}var re=F(J,[["render",ee],["__scopeId","data-v-6223857a"]]);export{re as default};
