var Q=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var j=(t,o,l)=>o in t?Q(t,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[o]=l,H=(t,o)=>{for(var l in o||(o={}))Z.call(o,l)&&j(t,l,o[l]);if(L)for(var l of L(o))ee.call(o,l)&&j(t,l,o[l]);return t},I=(t,o)=>W(t,X(o));import{a as N}from"./axios.9c966455.js";import{_ as $}from"./index.4a90c7e5.js";import{E as M,o as te,G as oe,a as y,b as _,c as E,w as g,f as s,d as F,H as w,g as x,J as k,F as b,e as B,K as R,M as D,O as h,u as ne,Q as V,r}from"./vendor.c046acaf.js";import{P as se}from"./PopDate.c7e8eca1.js";import{P as ae}from"./PopAdd.f35ae0ce.js";import{d as C,t as le}from"./index.af296ac2.js";const ie={emits:["select-type"],setup(t,o){const l=M({active:0,isShowType:!1,expenseTypes:[],incomeTypes:[]});te(async()=>{const{data:{list:d}}=await N.get("/type/list");l.expenseTypes=d.filter(v=>v.type==="1"),l.incomeTypes=d.filter(v=>v.type==="2")});const e=d=>{l.active=d.id,l.isShowType=!1,o.emit("select-type",d)};return I(H({},oe(l)),{selectType:e})}},z=t=>(R("data-v-79b6d8a7"),t=t(),D(),t),ce={class:"pop"},ue={class:"header van-hairline--bottom"},de=B(" \u8BF7\u9009\u62E9\u7C7B\u578B "),re={class:"content"},pe=z(()=>s("div",{class:"title"},"\u652F\u51FA",-1)),_e={class:"expense-wrap"},ve=["onClick"],fe=z(()=>s("div",{class:"title"},"\u6536\u5165",-1)),ye={class:"income-wrap"},me=["onClick"];function he(t,o,l,e,d,v){const i=y("van-icon"),p=y("van-popup");return _(),E(p,{show:t.isShowType,"onUpdate:show":o[2]||(o[2]=n=>t.isShowType=n),position:"bottom",round:""},{default:g(()=>[s("div",ce,[s("div",ue,[de,F(i,{name:"cross",class:"cross",onClick:o[0]||(o[0]=n=>t.isShowType=!1)})]),s("div",re,[s("div",{onClick:o[1]||(o[1]=n=>e.selectType({id:0,name:"\u5168\u90E8\u7C7B\u578B"})),class:w(["type-item",{active:t.active===0}])},"\u5168\u90E8\u7C7B\u578B",2),pe,s("div",_e,[(_(!0),x(b,null,k(t.expenseTypes,n=>(_(),x("p",{onClick:m=>e.selectType(n),class:w(["type-item",{active:t.active===n.id}]),key:n},h(n.name),11,ve))),128))]),fe,s("div",ye,[(_(!0),x(b,null,k(t.incomeTypes,n=>(_(),x("p",{class:w(["type-item",{active:t.active==n.id}]),onClick:m=>e.selectType(n),key:n},h(n.name),11,me))),128))])])])]),_:1},8,["show"])}var Fe=$(ie,[["render",he],["__scopeId","data-v-79b6d8a7"]]);const Te={name:"CardItem",props:{dayBillList:{type:Object}},setup(t){const o=ne();var l;(function(a){a[a.\u661F\u671F\u4E00=1]="\u661F\u671F\u4E00",a[a.\u661F\u671F\u4E8C=2]="\u661F\u671F\u4E8C",a[a.\u661F\u671F\u4E09=3]="\u661F\u671F\u4E09",a[a.\u661F\u671F\u56DB=4]="\u661F\u671F\u56DB",a[a.\u661F\u671F\u4E94=5]="\u661F\u671F\u4E94",a[a.\u661F\u671F\u516D=6]="\u661F\u671F\u516D",a[a.\u661F\u671F\u65E5=7]="\u661F\u671F\u65E5"})(l||(l={}));const e=t.dayBillList,d=l[C(e.date).get("day")],v=C(e.date).format("M\u6708D\u65E5"),i=V(()=>t.dayBillList.bills.reduce((a,c)=>(c.pay_type===1&&(a+=Number(c==null?void 0:c.amount)),a),0)),p=V(()=>t.dayBillList.bills.reduce((a,c)=>(c.pay_type===2&&(a+=Number(c==null?void 0:c.amount)),a),0));return{createAtDate:v,createAtDay:d,dayTotalExpense:i,dayTotalIncome:p,goToDetail:a=>{setTimeout(()=>{o.push({path:"/detail",query:{id:a.id}})},300)},dayjs:C,getHref:a=>{var T;return`#icon-${(T=le[a.type_id])==null?void 0:T.icon}`}}}},Y=t=>(R("data-v-2f03fe46"),t=t(),D(),t),ge={class:"item-header"},xe={class:"today-total"},we=Y(()=>s("div",null,"\u652F",-1)),Ee=Y(()=>s("div",null,"\u6536",-1)),ke={class:"icon"},be=["xlink:href"];function Be(t,o,l,e,d,v){const i=y("van-cell"),p=y("van-cell-group");return _(),E(p,{class:"item-wrap"},{default:g(()=>[s("div",ge,[s("div",null,h(e.createAtDate)+" "+h(e.createAtDay),1),s("div",xe,[s("div",null,[we,B(" "+h(e.dayTotalExpense.toFixed(2)),1)]),s("div",null,[Ee,B(" "+h(e.dayTotalIncome.toFixed(2)),1)])])]),(_(!0),x(b,null,k(l.dayBillList.bills,n=>(_(),E(i,{class:w(["bill-item",{expense:n.pay_type===1,income:n.pay_type===2}]),center:"",key:n.id,onClick:m=>e.goToDetail(n),title:n.type_name,value:`${n.pay_type==1?"-":"+"}${n.amount}`,label:`${e.dayjs(Number(n.date)).format("HH:mm")}${n.remark?" | "+n.remark:""}`},{icon:g(()=>[s("div",{class:w(["icon-wrap",{expense:n.pay_type===1,income:n.pay_type===2}])},[(_(),x("svg",ke,[s("use",{"xlink:href":e.getHref(n)},null,8,be)]))],2)]),_:2},1032,["class","onClick","title","value","label"]))),128))]),_:1})}var Ce=$(Te,[["render",Be],["__scopeId","data-v-2f03fe46"]]);const Se={components:{PopType:Fe,PopDate:se,BillItem:Ce,PopAdd:ae},setup(){const t=r(null),o=r(null),l=r(null),e=r([]),d=r(0),v=r(0),i=r(1),p=r(0),n=r([]),m=r(!1),a=r(!1),c=r(!1),T=r(C().format("YYYY-MM")),u=M({id:0,name:"\u5168\u90E8\u7C7B\u578B"}),O=f=>{Object.assign(u,f),S()},U=f=>{T.value=f,S()},q=async()=>{try{const{data:f}=await N.get(`/bill/list?date=${T.value}&type_id=${u.id||"all"}&page=${i.value}&page_size=31`);c.value&&(e.value=[],c.value=!1),m.value=!1,f.list.forEach(G=>{G.bills.sort((J,K)=>K.id-J.id)}),e.value=e.value.concat(f.list),d.value=f.totalExpense.toFixed(2),v.value=f.totalIncome.toFixed(2),p.value=f.totalPage}catch(f){console.log(f)}finally{i.value<p.value?i.value+=1:a.value=!0,m.value=!1}},P=()=>{!c.value&&i.value<p.value&&(i.value=i.value+1),q()},S=()=>{a.value=!1,i.value=1,c.value=!0,m.value=!0,P()};return{monthTotalExpense:d,monthTotalIncome:v,page:i,totalPage:p,list:n,loading:m,finished:a,refreshing:c,selectedDate:T,billList:e,selectedType:u,popTypeRef:t,popDateRef:o,popAddRef:l,handleSelectType:O,handleSelectDate:U,onRefresh:S,onLoad:P}}},A=t=>(R("data-v-3eb7a53c"),t=t(),D(),t),$e={class:"home"},Re={class:"header"},De={class:"all-type"},Ae=A(()=>s("svg",{class:"icon"},[s("use",{"xlink:href":"#icon-type"})],-1)),Pe={class:"data-wrap"},Le=A(()=>s("svg",{class:"icon icon-sort-down"},[s("use",{"xlink:href":"#icon-sort-down"})],-1)),je={class:"expense"},He={class:"income"},Ie={class:"content-wrap"},Ne=A(()=>s("svg",{class:"icon add-icon"},[s("use",{"xlink:href":"#icon-add-bill"})],-1)),Me=B(" \u8BB0\u4E00\u7B14 ");function Ve(t,o,l,e,d,v){const i=y("van-button"),p=y("BillItem"),n=y("van-list"),m=y("van-pull-refresh"),a=y("PopType"),c=y("PopDate"),T=y("PopAdd");return _(),x("div",$e,[s("div",Re,[F(i,{class:"type-wrap",size:"small",onClick:o[0]||(o[0]=u=>e.popTypeRef.isShowType=!0)},{default:g(()=>[s("span",De,h(e.selectedType.name||"\u5168\u90E8\u7C7B\u578B"),1),Ae]),_:1}),s("div",Pe,[F(i,{class:"time",size:"mini",onClick:o[2]||(o[2]=u=>e.popDateRef.isShowDate=!0)},{default:g(()=>[s("span",{class:"time",onClick:o[1]||(o[1]=u=>e.popDateRef.isShowDate=!0)},[s("span",null,h(e.selectedDate),1),Le])]),_:1}),s("span",je,"\u603B\u652F\u51FA \uFFE5"+h(e.monthTotalExpense),1),s("span",He,"\u603B\u6536\u5165 \uFFE5"+h(e.monthTotalIncome),1)])]),s("div",Ie,[F(m,{modelValue:e.refreshing,"onUpdate:modelValue":o[4]||(o[4]=u=>e.refreshing=u),onRefresh:e.onRefresh},{default:g(()=>[F(n,{loading:e.loading,"onUpdate:loading":o[3]||(o[3]=u=>e.loading=u),finished:e.finished,"finished-text":"\u6CA1\u6709\u66F4\u591A\u4E86",onLoad:e.onLoad},{default:g(()=>[(_(!0),x(b,null,k(e.billList,u=>(_(),E(p,{dayBillList:u,key:u.date},null,8,["dayBillList"]))),128))]),_:1},8,["loading","finished","onLoad"])]),_:1},8,["modelValue","onRefresh"])]),F(i,{type:"primary",round:"",class:"add-wrap",onClick:o[5]||(o[5]=u=>e.popAddRef.isShowAdd=!0)},{default:g(()=>[Ne,Me]),_:1}),F(a,{ref:"popTypeRef",onSelectType:e.handleSelectType},null,8,["onSelectType"]),F(c,{ref:"popDateRef",onSelectDate:e.handleSelectDate},null,8,["onSelectDate"]),F(T,{ref:"popAddRef",onRefresh:e.onRefresh},null,8,["onRefresh"])])}var Ke=$(Se,[["render",Ve],["__scopeId","data-v-3eb7a53c"]]);export{Ke as default};
